trigger: none

parameters:
  - name: GITHUB_USERNAME
    displayName: GITHUB_USERNAME
    type: string
    default: 'yourUsername'
  - name: GITHUB_PASSWORD
    displayName: GITHUB_PASSWORD
    type: string
    default: 'yourPasswordOrToken'

variables:
  - name: GITHUB_USERNAME
    value: yourUser
  - name: GITHUB_PASSWORD
    value: yourPassword

stages:
  - stage: build
    jobs:
      - job: run_build
        pool:
          vmImage: 'ubuntu-latest' # other options: 'macOS-latest', 'windows-latest'
        steps:
          # Build
          - task: Maven@3
            inputs:
              mavenPomFile: 'pom.xml'
              options: '--settings settings.xml -DGITHUB_USERNAME=$(GITHUB_USERNAME) -DGITHUB_PASSWORD=$(GITHUB_PASSWORD) -DskipTests'
              #javaHomeOption: 'JDKVersion'
              jdkVersionOption: '17'
              #jdkArchitectureOption: 'x64'
              #publishJUnitResults: true
              #testResultsFiles: '**/TEST-*.xml'
              goals: 'package spring-boot:repackage'

          # Deploy
          ## Copy files or build artifacts to a remote machine over SSH
          - task: CopyFilesOverSSH@0
            inputs:
              sshEndpoint: "odm-platform"
              sourceFolder: './azuredevops-server/target' # Optional
              contents: 'odm-platform-up-services-executor-azuredevops-server-1.0.0.jar'
              targetFolder: "/home/odm" # Optional
              overwrite: true # Optional

          ## Run shell commands or a script on a remote machine using SSH
          - task: SSH@0
            inputs:
              sshEndpoint: "odm-platform"
              runOptions: 'script' # Options: commands, script, inline
              scriptPath: "deployScript.sh" # Required when runOptions == Script